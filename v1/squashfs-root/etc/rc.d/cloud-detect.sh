#!/bin/sh

# Usage: Detect the internet status for setuping cloud-brd
# Just for Bug: Don't send deventry.tp-link.com first
# Ugly operation: FIXME

MONITOR_RUNTIME_FILE="/tmp/monitor_runtime_info"

while true
do
	[ -f $MONITOR_RUNTIME_FILE ] && {
		content=`cat $MONITOR_RUNTIME_FILE | sed "s/[[:space:]]//g"`
		for c in $content; do
			a=${c%:*}
			b=${c#*:}
			[ "$a" = '"internet_status"' -a "$b" = '"connected"' ] && {
				echo "Internet detected, run cloud-brd"
				cloud-brd -c /etc/config.cfg &
				unset content
			}	
		done
		[ -z "$content" ] && break
	}
	sleep 2
done
