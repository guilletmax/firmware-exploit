#!/bin/sh

#=============================================================================
# smp_affinity: 1 = CPU1, 2 = CPU2, 3 = CPU3, 4 = CPU4
# rps_cpus: wxyz = CPU3 CPU2 CPU1 CPU0 (ex:0xd = 0'b1101 = CPU1, CPU3, CPU4)
#=============================================================================

#. /sbin/config.sh

if [ ! -n "$1" ]; then
  echo "insufficient arguments!"
  echo "Usage: $0 <mode>"
  exit 0
fi

OPTIMIZED_FOR="$1"

if [ $OPTIMIZED_FOR == "1" ]; then
	switch reg w 2004 ff0000 #port0
	switch reg w 2604 ff0000 #port6

	#LAN/WAN ports as transparent mode
	switch reg w 2010 810000c0 #port0
	switch reg w 2610 810000c0 #port6

	#clear mac table if vlan configuration changed
	switch clear
	switch vlan clear

elif [ $OPTIMIZED_FOR == "2" ]; then

	switch reg w 2004 ff0003 #port0
	switch reg w 2604 ff0003 #port6
	#LAN/WAN ports as transparent mode
	switch reg w 2010 810000c0 #port0
	switch reg w 2610 810000c0 #port6

	#clear mac table if vlan configuration changed
	switch clear
	#switch vlan clear

else

	echo "unknow arguments!"
	exit 0

fi
